<% $subtot_perm = 0 %>
<% $subtot_um = 0 %>
<% $subtot_cinco = 0 %>
<% $subtotal_titulos = 0 %>
<%  @tp = TituloProfessor.find_by_sql("SELECT * FROM titulo_professors tp inner join titulacaos t on tp.titulo_id=t.id where tp.professor_id=" + $professor + " and t.tipo = 'PERMANENTE'")%>
<%  @tp1 = TituloProfessor.find_by_sql("SELECT * FROM titulo_professors tp inner join titulacaos t on tp.titulo_id=t.id where tp.professor_id=" + $professor + " and t.tipo = 'ANUAL'")%>
<%  @tp5 = TituloProfessor.find_by_sql("SELECT * FROM titulo_professors tp inner join titulacaos t on tp.titulo_id=t.id where tp.professor_id=" + $professor + " and t.tipo = '5 ANOS'")%>
<%  @total_trabalhado = Professor.find($professor).total_trabalhado %>
<table width="100%" frame="box" rules="all">

<tr><th width="100%" colspan="6" align="center"><hr/>Títulos Permanentes<hr/></th></tr>

     <tr>
       <th>
        Título
       </th>
       <th>
        Quantidade
       </th>
       <th>
        Valor do Título
       </th>
       <th>
        Pontuação Obtida
       </th>
     </tr>

<%for tp in @tp%>

     <tr>
      <td align="center">
        <%= Titulacao.find_by_id(tp.titulo_id).descricao %>
      </td>
      <td align="center">
        <%= tp.quantidade %>
      </td>
      <td align="center">
        <%= tp.valor %>
      </td>
      <td align="center">
        <%= tp.pontuacao_titulo %>
        <% $subtot_perm = $subtot_perm + (tp.pontuacao_titulo).to_f %>
      </td>

     <td align="right">
            <%= link_to_remote('Alterar', :update =>  "titula", :url => { :action => "alt_titulo_professor"}) %> 
     </td>

   </tr>
  <%end%>
<tr>
  <th width="80%" colspan="4" align="left">SUB-TOTAL </th>
  <th align="right">

    <%= $subtot_perm %>
  </th>
</tr>

</table>

<table width="100%" frame="box" rules="all">

<tr><th width="100%" colspan="6" align="center"><hr/>Títulos de Contagem Anual<hr/></th></tr>
     <tr>
       <th align="center">
        Título
       </th>
       <th align="center">
        Quantidade
       </th>
       <th align="center">
        Valor do Título
       </th>
       <th align="center">
        Pontuação Obtida
       </th>
     </tr>

<%for tp1 in @tp1%>
     <tr>
      <td  align="center">

        <%= Titulacao.find_by_id(tp1.titulo_id).descricao %>
      </td>
      <td  align="center">
        <%= tp1.quantidade %>

      </td>
      <td  align="center">

        <%= tp1.valor %>
      </td>
      <td  align="center">
        <%= tp1.pontuacao_titulo %>
        <% $subtot_um = $subtot_um + (tp1.pontuacao_titulo).to_f %>
      </td>

     <td align="right">
           <%= link_to_remote('Alterar', :update =>  "titula", :url => { :action => "alt_titulo_professor"}) %>
     </td>
   </tr>
  <%end%>
<tr>
  <th width="80%" colspan="4" align="left">SUB-TOTAL </th>
  <th  align="right">
    <%= $subtot_um %>
  </th>
</tr>


<% $subtotal_titulos = $subtot_um + $subtot_cinco + $subtot_perm %>
</table>
<br/>
<table width="100%" frame="box" rules="all">
<tr>
  <th width="80%" colspan="4" align="left">TOTAL TÍTULOS</th>
  <th align="right">
    <%= $subtotal_titulos %>
  </th>
</tr>
</table>

<div id="eu">

    <%  @acum = Professor.find(:all, :conditions => ['id=' + $professor]) %>
    <% form_for(@acum) do |f| %>
      <%= f.error_messages %>
        <%= f.hidden_field(:total_titulacao, :value => $subtotal_titulos)   %>
        <%= f.hidden_field(:total_trabalhado, :value => @total_trabalhado) %>
      <p>
        <%= f.submit "Totalizar", :controller => 'professors/edit' %>
      </p>


    <%  end %>

</div>




