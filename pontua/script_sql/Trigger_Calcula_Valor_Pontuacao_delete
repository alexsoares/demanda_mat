drop trigger if exists calcula_pontos_delete;

delimiter $$
CREATE TRIGGER calcula_pontos_delete
AFTER delete ON titulo_professors
FOR EACH ROW
BEGIN
if old.status = 1 then
	SELECT pontuacao_final INTO @pf from professors where id = old.professor_id;
	SELECT total_trabalhado INTO @tt from professors where id = old.professor_id;
	SELECT total_titulacao INTO @tit from professors where id = old.professor_id;
	SET @total_titula = (@tit - old.valor);
	UPDATE professors SET pontuacao_final = (@total_titula + @tt) where id = old.professor_id;
	UPDATE professors SET total_titulacao = @total_titula where id = old.professor_id;

end if;

 END$$
delimiter ;




